<Page x:ConnectionId='1'
    x:Class="Counters.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Counters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="using:Microsoft.Phone.Controls"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" 
                        >

    <Page.Resources>

        <local:AppSettings x:Key="settings"/>
        <local:BooleanToVisibilityConverter x:Key="visConv"/>
        <local:InverseBooleanConverter x:Key="conv"/>

        <ItemsPanelTemplate x:Key="tmpPanel">
            <WrapGrid Orientation="Horizontal"/>
        </ItemsPanelTemplate>

        <DataTemplate x:Key="lbiMainMenuItem">
            <Grid>
                <toolkit:HubTile x:ConnectionId='2' Name="MainMenuItem" Source="{Binding ImgSource}" Background="{Binding Background}" Title="{Binding Title}"
                                 Message="{Binding Message}"                         Margin="5"/>
                <Grid x:ConnectionId='3' Name="Lock" Visibility="{Binding IsLocked, Converter={StaticResource visConv}}"                     >
                    <Rectangle Fill="Black" Opacity="0.8"/>
                    <Image Source="/Images/MainMenu/lock.png" Width="80" Height="80"/>
                </Grid>
            </Grid>
        </DataTemplate>

    </Page.Resources>

    <ScrollViewer VerticalAlignment="Center">
        <ItemsControl ItemsPanel="{StaticResource tmpPanel}" HorizontalAlignment="Center"
                          ItemTemplate="{StaticResource lbiMainMenuItem}">
            <ItemsControl.ItemsSource>
                <local:MainMenuItems>
                    <local:MainMenuItem ImgSource="/Images/MainMenu/counters.png" Background="SteelBlue" Title="Счетчики"
                             Message="Ввод показаний, графики" Page="Counters.Counters"/>
                    <local:MainMenuItem ImgSource="/Images/MainMenu/services.png" Background="Coral" Title="Услуги"
                             Message="Ежемесячные платежи" Page="Counters.Services"/>

                    <local:MainMenuItem ImgSource="/Images/MainMenu/scores.png" Background="Firebrick" Title="Счета"
                             Message="Суммарные показания по указанным счетчикам и услугам" Page="Counters.Scores"/>
                    <local:MainMenuItem ImgSource="/Images/MainMenu/charts.png" Background="OliveDrab" Title="Графики"
                             Message="Набор графиков для аналитики" Page="Counters.Charts"/>

                    <local:MainMenuItem ImgSource="/Images/MainMenu/alarm.png" Background="Teal"  Title="Напоминания"
                             Message="Настройка периодических уведомлений" Page="Counters.Notifications"/>
                    <local:MainMenuItem ImgSource="/Images/MainMenu/email.png" Background="RosyBrown"  Title="Экспорт"
                             Message="Отправка данных на электронную почту, выгрузка в Excel" Page="Counters.Export" 
                             IsLocked="{Binding IsFullVersion,Source={StaticResource settings},Converter={StaticResource conv}}"/>
                </local:MainMenuItems>
            </ItemsControl.ItemsSource>
        </ItemsControl>
    </ScrollViewer>

    <Page.BottomAppBar>
        <CommandBar>
            <AppBarButton x:ConnectionId='4' Name="btnSettings" Label="Настройки"                          >
                <AppBarButton.Icon>
                    <BitmapIcon UriSource="ms-appx:///Images/AppBar/settings.png"/>
                </AppBarButton.Icon>
            </AppBarButton>
        </CommandBar>
    </Page.BottomAppBar>

</Page>

